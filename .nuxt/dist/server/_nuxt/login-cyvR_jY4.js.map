{"version":3,"file":"login-cyvR_jY4.js","sources":["../../../../pages/login.vue"],"sourcesContent":["<template>\n  <div>\n    <NuxtLayout name=\"auth\">\n      <div class=\"p-5 md:p-10 text-center rounded-xl bg-white\">\n        <h1 class=\"text-xl md:text-2xl  mb-5 md:mb-10\">Добро пожаловать в AuthApp!</h1>\n        <form class=\"flex flex-col  gap-4 md:gap-8\" @submit=\"onSubmit\">\n          <div>\n            <label class=\"input input-bordered flex items-center gap-2 mb-1\">\n              <IconsEmail class=\"h-4 w-4\" />\n              <input tabindex=\"1\" v-model=\"email\" v-bind=\"emailAttrs\" type=\"email\" class=\"grow\" placeholder=\"Email\" autofocus=\"off\"/>\n            </label>\n            <div class=\"w-[20%] text-xs text-error text-left pl-4\">{{ errors.email }}</div>\n          </div>\n          <div>\n            <label class=\"input input-bordered flex items-center gap-2 mb-1\">\n              <IconsPassword />\n              <input  tabindex=\"2\" v-model=\"password\" v-bind=\"passwordAttrs\" type=\"password\" class=\"grow\" placeholder=\"Password\" />\n            </label>\n            <div class=\"w-[20%] text-xs text-error text-left pl-4\">\n              {{ errors.password }}\n            </div>\n          </div>\n          <label v-if=\"showOtp\">\n            <p class=\"mb-2\">Введите код из приложения для аутентификации:</p>\n            <UiOTP :digit-count=\"6\" small @update:otp=\"twoFactorAuthenticationCode = $event\" />\n          </label>\n          <input  :disabled=\"!twoFactorAuthenticationCode && showOtp\" type=\"submit\" value=\"Войти\" class=\"btn\" />\n        </form>\n        <p class=\"mt-5 md:text-base\">\n          Нет аккаунта?\n          <NuxtLink to=\"/sign-up\" class=\"link link-primary\"> Зарегистрироваться </NuxtLink>\n        </p>\n      </div>\n    </NuxtLayout>\n  </div>\n</template>\n<script setup>\nimport { useForm } from \"vee-validate\";\nimport { toTypedSchema } from \"@vee-validate/zod\";\nimport { z } from \"zod\";\nconst router = useRouter();\nconst { authenticateUser } = useAuth();\n\nconst showOtp = ref(false);\nconst twoFactorAuthenticationCode = ref(\"\");\n\nconst schema = toTypedSchema(\n  z.object({\n    email: z.string().min(1).email(),\n    password: z.string().min(1),\n  }),\n);\n\nconst { errors, handleSubmit, defineField } = useForm({\n  validationSchema: schema,\n});\n\nconst onSubmit = handleSubmit(async (values) => {\n  const { data, error } = await authenticateUser(\n    showOtp ? { ...values, twoFactorAuthenticationCode: twoFactorAuthenticationCode.value } : values,\n  );\n  showOtp.value = error.value?.statusCode === 403;\n  if (error.value?.statusCode === 401) twoFactorAuthenticationCode.value = \"\";\n  if (!error.value && data.value) router.push(\"/profile\");\n});\n\nconst [email, emailAttrs] = defineField(\"email\");\nconst [password, passwordAttrs] = defineField(\"password\");\n\nwatch([email, password], () => {\n  twoFactorAuthenticationCode.value = \"\";\n  showOtp.value = false;\n});\n</script>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCA,UAAM,SAAS,UAAS;AACxB,UAAM,EAAE,iBAAgB,IAAK;AAE7B,UAAM,UAAU,IAAI,KAAK;AACzB,UAAM,8BAA8B,IAAI,EAAE;AAE1C,UAAM,SAAS;AAAA,MACb,EAAE,OAAO;AAAA,QACP,OAAO,EAAE,OAAM,EAAG,IAAI,CAAC,EAAE,MAAO;AAAA,QAChC,UAAU,EAAE,SAAS,IAAI,CAAC;AAAA,MAC9B,CAAG;AAAA,IACH;AAEA,UAAM,EAAE,QAAQ,cAAc,YAAW,IAAK,QAAQ;AAAA,MACpD,kBAAkB;AAAA,IACpB,CAAC;AAED,UAAM,WAAW,aAAa,OAAO,WAAW;;AAC9C,YAAM,EAAE,MAAM,MAAO,IAAG,MAAM;AAAA,QAC5B,UAAU,EAAE,GAAG,QAAQ,6BAA6B,4BAA4B,MAAK,IAAK;AAAA,MAC9F;AACE,cAAQ,UAAQ,WAAM,UAAN,mBAAa,gBAAe;AAC5C,YAAI,WAAM,UAAN,mBAAa,gBAAe,IAAK,6BAA4B,QAAQ;AACzE,UAAI,CAAC,MAAM,SAAS,KAAK,MAAO,QAAO,KAAK,UAAU;AAAA,IACxD,CAAC;AAED,UAAM,CAAC,OAAO,UAAU,IAAI,YAAY,OAAO;AAC/C,UAAM,CAAC,UAAU,aAAa,IAAI,YAAY,UAAU;AAExD,UAAM,CAAC,OAAO,QAAQ,GAAG,MAAM;AAC7B,kCAA4B,QAAQ;AACpC,cAAQ,QAAQ;AAAA,IAClB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}