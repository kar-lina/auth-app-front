{"version":3,"file":"settings-D67qs8iO.js","sources":["../../../../composables/useDate.ts","../../../../components/Profile/Settings/TwoFA.vue","../../../../pages/settings.vue"],"sourcesContent":["import dayjs from \"dayjs\";\n\nexport const useDate = (date: Date, format = \"DD.MM.YYYY\") => dayjs(date).format(format);\n","<template>\n  <div class=\"card max-w-[360px] bg-base-100 shadow-xl\">\n    <figure>\n      <img\n        src=\"https://www.axiad.com/wp-content/uploads/2022/07/2-Factor-Authentication.jpg\"\n        alt=\"2-Factor-Authentication\"\n      />\n    </figure>\n    <div class=\"card-body\">\n      <h2 class=\"card-title\">Двухэтапная аутентификация!</h2>\n      <template v-if=\"!currentUser?.isTwoFactorAuthenticationEnabled\">\n        <p>Для дополнительной защиты аккаунта, включите двухфакторную аутентификацию</p>\n        <div class=\"card-actions justify-end\">\n          <button class=\"btn btn-info\" @click=\"enable2fa\">Включить</button>\n        </div>\n      </template>\n      <template v-else>\n        <p>\n          Двухфаторная аутентификая включена\n          <tempalte v-if=\"currentUser.twoFactorAuthenticationSecretEnabledAt\">\n            {{ useDate(currentUser.twoFactorAuthenticationSecretEnabledAt) }}\n          </tempalte>\n        </p>\n        <div class=\"card-actions justify-between mt-2\">\n          <button class=\"btn\" @click=\"disable2FAModalOpen = true\">Выключить</button>\n          <button class=\"btn btn-info\" @click=\"showQR\">Показать QR-code</button>\n        </div>\n      </template>\n    </div>\n    <UiModal id=\"2fa-modal\" :visible=\"!!qrCodeImg\">\n      <template #content>\n        <div class=\"flex flex-col items-center gap-4\">\n          <h1 class=\"text-xl\">Настройка приложения аутентификации.</h1>\n          <ul class=\"list list-disc mb-5\">\n            <li>В приложении Google Authenticator нажмите на значок \"+\".</li>\n            <li>Отсканируйте QR-код</li>\n          </ul>\n          <img :src=\"qrCodeImg\" />\n          <div tabindex=\"0\" class=\"collapse collapse-arrow border-base-300 bg-base-200 border\">\n            <div class=\"collapse-title text-base\">Не получается отсканировать QR-код?</div>\n            <div class=\"collapse-content text-sm\">\n              <ol class=\"list-decimal flex flex-col gap-2 p-4\">\n                <li>\n                  В приложении Google Authenticator нажмите на значок\n                  <strong>+</strong>, а затем выберите <strong>Ввести ключ настройки</strong>.\n                </li>\n                <li>\n                  Укажите адрес электронной почты и этот ключ (пробелы не учитываются):\n                  <div>\n                    <strong>{{ twoFASecrete }}</strong>\n                  </div>\n                </li>\n                <li>Убедитесь, что выбран параметр <strong>По времени</strong>.</li>\n                <li>Чтобы завершить настройку, нажмите <strong>Добавить</strong>.</li>\n              </ol>\n            </div>\n          </div>\n        </div>\n      </template>\n    </UiModal>\n    <UiModal id=\"2fa-enable\" :visible=\"disable2FAModalOpen\">\n      <template #content>\n        <div class=\"flex flex-col gap-6 items-center text-center\">\n          <p>Для отключения двухфаторной аутентификации введите код из приложения</p>\n          <UiOTP :digit-count=\"6\" @update:otp=\"twoFactorAuthenticationCode = $event\" />\n          <button :disabled=\"!twoFactorAuthenticationCode\" class=\"btn btn-info\" @click=\"disble2fa\">Отключить</button>\n        </div>\n      </template>\n    </UiModal>\n  </div>\n</template>\n<script setup lang=\"ts\">\nconst { currentUser, getAuth } = useAuth();\nconst { alert } = useToastStore();\n\nconst qrCodeImg = ref(\"\");\nconst twoFASecrete = ref(\"\");\nconst disable2FAModalOpen = ref(false);\n\nconst showQR = async () => {\n  try {\n    const res: { otpauthUrl: string; secret: string } = await useNuxtApp().$api(\"/2fa/qr-code\");\n    if (res.otpauthUrl) {\n      qrCodeImg.value = res.otpauthUrl;\n      twoFASecrete.value = res.secret;\n    }\n    getAuth();\n  } catch (error: any) {\n    alert(error, \"error\");\n  }\n};\nconst enable2fa = async () => {\n  try {\n    const res: { otpauthUrl: string; secret: string } = await useNuxtApp().$api(\"/2fa/turn-on\", {\n      method: \"post\",\n    });\n    if (res.otpauthUrl) {\n      qrCodeImg.value = res.otpauthUrl;\n      twoFASecrete.value = res.secret;\n    }\n    getAuth();\n  } catch (error: any) {\n    alert(error, \"error\");\n  }\n};\nconst twoFactorAuthenticationCode = ref(\"\");\n\nconst disble2fa = async () => {\n  if (!twoFactorAuthenticationCode) return;\n  try {\n    const res: { otpauthUrl: string } = await useNuxtApp().$api(\"/2fa/turn-off\", {\n      method: \"post\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: {\n        twoFactorAuthenticationCode: twoFactorAuthenticationCode.value,\n      },\n    });\n    getAuth();\n    alert(\"Двухфакторная аутентификация отключена\", \"info\");\n    disable2FAModalOpen.value = false;\n  } catch (error: any) {\n    // console.log(error);\n  }\n};\n</script>\n\n<style>\n.card {\n  flex: 1 1 340px;\n}\n.modal::backdrop {\n  background-color: #0006;\n  animation: modal-pop 0.2s ease-out;\n}\n</style>\n","<template>\n  <div>\n    <NuxtLayout>\n      <div class=\"flex flex-col items-center gap-3 md:gap-5 pt-5 md:pt-20\">\n        <h1 class=\"title text-4xl leading-10\">Настройки аккаунта</h1>\n        <div class=\"max-w-[60%] text-center\">\n          Настройте параметры конфиденциальности и безопасности, чтобы вам было\n          ещё удобнее пользоваться сервисами AuthApp.\n        </div>\n        <div class=\"flex flex-wrap\">\n          <ProfileSettingsTwoFA />\n        </div>\n      </div>\n    </NuxtLayout>\n  </div>\n</template>\n"],"names":["_ssrRenderAttrs","_ssrRenderComponent","_withCtx","_push","_parent","_createVNode"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEa,MAAA,UAAU,CAAC,MAAY,SAAS,iBAAiB,MAAM,IAAI,EAAE,OAAO,MAAM;;;;;ACsEvF,UAAM,EAAE,aAAa,QAAQ,IAAI,QAAQ;AACnC,UAAA,EAAE,UAAU;AAEZ,UAAA,YAAY,IAAI,EAAE;AAClB,UAAA,eAAe,IAAI,EAAE;AACrB,UAAA,sBAAsB,IAAI,KAAK;AA4B/B,UAAA,8BAA8B,IAAI,EAAE;AAE1C,UAAM,YAAY,YAAY;AAC5B,UAAI,CAAC,4BAA6B;AAC9B,UAAA;AACF,cAAM,MAA8B,MAAM,aAAa,KAAK,iBAAiB;AAAA,UAC3E,QAAQ;AAAA,UACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,UAC9C,MAAM;AAAA,YACJ,6BAA6B,4BAA4B;AAAA,UAC3D;AAAA,QAAA,CACD;AACO;AACR,cAAM,0CAA0C,MAAM;AACtD,4BAAoB,QAAQ;AAAA,eACrB,OAAY;AAAA,MAErB;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1HF,QAAA,OAAAA,eAAA,MAAA,CAAA,GAAA;AAAA,QAAAC,mBAaiB,uBAAA,MAAA;AAAA,IAbjB,SAAAC,QAAA,CAAA,GAAAC,QAAAC,UAAA,aAAA;AAAA,UAAAD,QAAA;AAAA,QAAAA,OAAA,+EAAA,iDAAA,uEAAA,gKAAA,GAAA;AAAA,QAAAA,OAAAF,mBAAA,iCAAA,MAAA,MAAAG,UAAA,QAAA,CAAA;;;eAYY;AAAA,UARJC,YAAA,OAAI,EAAA,OAAM,0DAA8C,GAAA;AAAA,YACxDA,YAGM,MAHD,EAAA,OAAM,+BAGX,oBAAA;AAAA,YACAA,YAEM,OAAA,EAFD,OAAM,0BAAgB,GAAA,qHAAA;AAAA,wBACD,OAAA,EAAA,OAAA,iBAAA,GAAA;AAAA;;;;;KAVlC;AAAA;EAAA,GAAA,OAAA,CAAA;;;;;;;;;;"}